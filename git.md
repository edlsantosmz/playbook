# Git Essential Training
## Getting Started
### Performing your first commit


```
git add .
git commit -m "<comment>"
```

Git process
* Make changes
* Add changes
* Commit changes to the repository with a message

### Writing commit mesages 

What you really want to do is have a commit message that describes the changes that you're making in that commit set, so added file to project, that would be more descriptive saying that we added this first file. We are labeling what we were doing in this change set so when we come back and look at it later, we can just look at the commit message and know what's inside, what's contained in that set.

Commit message best practices
* short single-line summary, less than 50 characters
* Optionally, we can follow that by a blank line and then a more complete description
* keep those additional lines to less than 72 characters
* write commit messages in the present tense, not in the past tense, you are labeling what this commit does, not what you--as the creator--were doing. Label what it does. This fixes a bug, not I fixed a bug. It's not about you, it's about what this commit is.
*  bullet points that describe what happens you usually use asterisk or hyphens
* Add ticket tracking numbers from bugs or support requests or develop a shorthand for your organization
* Can develop shorthand for your organization
** "[cs,js]"
** "bugfix:"
** "#8981 - " 

Label

* Be clear and descriptive
** Bad: "Fix typo"
** Good: "Add missing > in project section of HTML" 
** Bad: "Update Login code"
** Good: "Change user authentication to use Blowfish"

Example
```
t23094 - Fixes bug in admin logout.

When an admin logged out of the admin area, they could not log in to the members area because their session :user_id was still set to the admin ID. This patch fixes the bug by setting session :user_id to nil when any user logs out of any area.
```

`Notice that it describes what the problem was and then describes what the solution was as well.``

### Viewing the commit log
```
git log
commit f247c20fe52a6fb0acf1d2773cb7b6699058461c (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Fri Jul 27 21:57:21 2018 +0200

    Initial commit
```
Where
* commit: unique ID
* author: pulled from the global configuration

`git help log`

See number of commits
`git log -n <number>`

See commits in a specific period of time
```
git log --since=YY-MM-DD
git log --until=YY-MM-DD
git log --author="<name>"
```

Regular eexpression search in the commit message
`git log --grep="<regex-string>"`

## Git concepts and architecture
### Exploring the three-trees architecture
![alt text](https://github.com/edlsantosmz/playbook/blob/master/images/Skärmavbild%202018-07-27%20kl.%2022.18.55.png "Two tree architecture")

![alt text](https://github.com/edlsantosmz/playbook/blob/master/images/Skärmavbild%202018-07-27%20kl.%2022.23.10.png "Three-tree architecture")

* Working copy: where we have our changes that we've made, and we've saved, and saved to our hard drive, but we have not yet committed them to the repository, we haven't told Git to make this a changed set and to track it.
* Staging index, which is where we prepare things, we stage them for the commit, and then after they've been staged, we commit them to the repository so that they are permanently tracked and they now have a commit message attached to them.

### Git workflow

### Using hash value (SHA-1)
* Git generates a checksum for each changed set.
    * A checksum is a number that's generated by taking data and feeding it into an algorithm, so checksum algorithm converts data into a simple number, and we call that simple number a checksum
    * Changing the data changes the checksum
* Git generates this checksum is by using the SHA-1 hash algorithm
    * The number that the algorithm generates is always going to be a 40 character hexadecimal string. Hexadecimal means they can have the numbers 0 through 9 and the letters a through f.

![alt text](https://github.com/edlsantosmz/playbook/blob/master/images/git_referring_to_commits.png)

### The HEAD pointer
Git maintains a reference variable called HEAD, all capitals, H-E-A-D. And we call this variable a pointer, because its purpose is to reference, or point to, a specific commit in the repository as we make new commits the pointer is going to change or move to point to a new commit.

HEAD
* Pointer to "tip" of current branch in repository
* Last state of repository, what was last checked out
* Not staging or working environment
* [analogy] - recording audio in a tape

![alt text](https://github.com/edlsantosmz/playbook/blob/master/images/git_head.png)

```
cd .git
Eduardos-MacBook-Pro:.git eduardos$ ls -ls
total 88
 8 -rw-r--r--   1 eduardos  staff     15 27 Jul 21:57 COMMIT_EDITMSG
 8 -rw-r--r--   1 eduardos  staff     23 27 Jul 21:56 HEAD
 8 -rw-r--r--   1 eduardos  staff    137 27 Jul 21:56 config
 8 -rw-r--r--   1 eduardos  staff     73 27 Jul 21:56 description
 0 drwxr-xr-x  12 eduardos  staff    384 27 Jul 21:56 hooks
56 -rw-r--r--   1 eduardos  staff  27715 27 Jul 21:57 index
 0 drwxr-xr-x   3 eduardos  staff     96 27 Jul 21:56 info
 0 drwxr-xr-x   4 eduardos  staff    128 27 Jul 21:57 logs
 0 drwxr-xr-x  88 eduardos  staff   2816 27 Jul 21:57 objects
 0 drwxr-xr-x   4 eduardos  staff    128 27 Jul 21:56 refs
Eduardos-MacBook-Pro:.git eduardos$ cat HEAD
ref: refs/heads/master
Eduardos-MacBook-Pro:.git eduardos$ cat refs/heads/master
f247c20fe52a6fb0acf1d2773cb7b6699058461c
```
`git log HEAD`

## Making changes to files
### Adding files
```
git status
On branch master

No commits yet

Changes to be committed:  <--- Staging index, things that are being staged
  (use "git rm --cached <file>..." to unstage)

	new file:   one

Untracked files: <---- Things in our working directory
  (use "git add <file>..." to include in what will be committed)

	second
    
git commit -m "Adding one"
[master (root-commit) 7295b6b] Adding one
 1 file changed, 1 insertion(+)
 create mode 100644 one

git add second

git commit -m "Adding second"
[master 4b39a35] Adding second
 1 file changed, 2 insertions(+)
 create mode 100644 second
 
git status
On branch master
nothing to commit, working tree clean
```

### Editing files

```
git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   one

Untracked files:
  (use "git add <file>..." to include in what will be committed)

	third

no changes added to commit (use "git add" and/or "git commit -a")
$ git add one
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	modified:   one

Untracked files:
  (use "git add <file>..." to include in what will be committed)

	third

$ git commit -m "updated one"
[master 45fff06] updated one
 1 file changed, 1 insertion(+), 1 deletion(-)
Eduardos-MacBook-Pro:git_lesson eduardos$ git status
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	third

nothing added to commit but untracked files present (use "git add" to track)
``` 

### Viewing changes with diff

`git diff <file>`
Return the changes that are in the working directory

```
$ git diff
diff --git a/second b/second
index eba21f2..7b2e797 100644
--- a/second	<--- Version in the stage index (old)
+++ b/second	<--- Version in the working directory (new)
@@ -1,2 +1,2 @@
-second		<--- old version
+second text	<--- new version
``` 

### Viewing only staged changes

`git diff --staged`
Return the changes that are in the staging index

``` 
$git diff --staged
diff --git a/second b/second
index eba21f2..7b2e797 100644
--- a/second	<--- Version in the repository (old)
+++ b/second	<--- Version in the staging index (new)
@@ -1,2 +1,2 @@
-second
+second text
``` 
### Deleting files
Command: `git rm <file>`

``` 
$ git rm third
rm 'third'
Eduardos-MacBook-Pro:git_lesson eduardos$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	deleted:    third

$ git commit -m "remove third"
[master eb79e59] remove third
 1 file changed, 1 deletion(-)
 delete mode 100644 third
 ``` 

### Moving and renaming files
Command: `git mv <file>`

```
$ git mv one first_file.txt
$ mkdir images
$ git mv second images/info.txt
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	renamed:    one -> first_file.txt
	renamed:    second -> images/info.txt
``` 

## Git in a real project

### git diff
Use less pager which is built into UNIX. 

**Toggle fold long lines:** `minus sign(-) + shift + S + return` or start it up using the -R command, and you can set that in your global configuration

**Backwards:**: `b`

**Forwards:** `f`

#### Color the output
`git diff --color-words <file>`

```
git diff --color-words contact.html
diff --git a/contact.html b/contact.html
index 80d262c..b99781c 100755
--- a/contact.html
+++ b/contact.html
@@ -71,7 +71,7 @@
            <p>If you're on this page, we're guessing you've got something to say! Drop us a line, and be sure to sign up for our newsletter. If you're looking for our seasonal tours,  let us know when you're thinking of taking a trip. No

            <h2>Support options</h2>
            <p>If you're currently on a tour and need support, please visit our <a href="support.html">support</a> page. If none of these options are right for you and you still need to get in touch with us, feel free to call us at<span c
          </div>

          <form id="frmContact" name="frmContact" method="post" action="contact_process.html">
@@ -270,7 +270,7 @@
          <h2>Explore California</h2>
          <p>5605 Nota Street<br />
            Ventura, CA 93003</p>
          <p>866.555.4310<br />866.555.4315/>866.555.41314 <em>(24 hour support)</em></p>
        </div>
      </div>
    </div>
``` 

#### Shortcut: git add + git commit

`git commit -am "<message>`: Add it to the staging index and then commit it. All in one big move

```
git commit -am "Updating phone number"
[master 30ddb0c] Updating phone number
 10 files changed, 12 insertions(+), 12 deletions(-)
``` 

Caveat 1: grabs everyting in yor working envrionment

Caveat 2: files that are not being tracked or being deleted doesn't work

Examples:
``` 
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	modified:   tours.html
	renamed:    tours/tour_detail_backpack.html -> tours/tour_detail_backpack_cal.html
	modified:   tours/tour_detail_bigsur.html

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   contact.html
	
$ git commit -m "Renamed backpack cal for clarity"
[master 11a13c7] Renamed backpack cal for clarity
 3 files changed, 2 insertions(+), 2 deletions(-)
 rename tours/{tour_detail_backpack.html => tour_detail_backpack_cal.html} (100%)
 
  git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   contact.html

git commit -am "Remove some contractions"
[master 4d1fcbe] Remove some contractions
 1 file changed, 1 insertion(+), 1 deletion(-)
 
 ``` 
## Undoing changes
### Undoing working directory changes
`git checkout -- <file/folder>` 
* Undo files from your working environment

It's a good practice when we're not trying to checkout a branch to put dash--dash, followed by index.html that says stay on the current branch. That bare double dash is just there to indicate that we're not checking out a new branch, we're just talking about a file in the current branch. Makes my working directory file look like what the repository has.

```
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   resources.html

no changes added to commit (use "git add" and/or "git commit -a")
$ git diff --staged
$ git checkout -- resources.html
$ git status
On branch master
nothing to commit, working tree clean
```

### Unstaging files
`git reset HEAD <file>`
* Resets the staging index whit what is in the repository
* Undo the changes in staging and bring them out to the working environment.

What we're telling it is go look at the HEAD pointer.
The HEAD pointer points to the last commit of the tip of the current branch, which is master. That's our current branch. Go look at that last commit and reset yourself to be the same as what that has. Very similar to what checkout did. Checkout went and checked out that file from the Repo. Here we're resetting the index to be the same as that.

``` 
$ git reset HEAD resources.html
Unstaged changes after reset:
M	resources.html
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   resources.html
```

### Amending commits
`git commit --amend -m "<message>"`

* Amend commit message
* Amend content of the commit
* SHA will change every time

### Retrieving old versions
`git checkout <commit-id> -- <file>`
* When you check it out from our particular revision, it puts it into your staging area.

``` 
$ git checkout 4d1fcbe61d -- resources.html
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	modified:   resources.html

```
`git diff --staged`


Take part of the SHA and copy it and then say this commit reverts commit, and give that SHA, so it's a reference

`git diff --staged`

### Reverting a commit
`git revert <commit-id>`
* Make an exact mirror image commit

```
$ git revert 9cbe0
[master d3af33e] Revert "Rearrange items to bring on an outdoor trip"
 1 file changed, 3 insertions(+), 3 deletions(-)
$ git log
commit d3af33ebc62f0a7a2d91832fd5382f0e79808e72 (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 12:40:48 2018 +0200

    Revert "Rearrange items to bring on an outdoor trip"

    This reverts commit 9cbe0c7fb83892b712020506dd246a429d0b3632.
```

### Using reset to undo commits
`git reset`: Allows us to specify where the HEAD pointer should point to.
* `--soft` 
	* does not change staging inde or working directory, it's just going to move the pointer
* `--mixed` (default)
	* it moves the HEAD pointer to the specified commit
	* changes staging index to match repository
	* does not change working directory
* `--hard`
	* makes our staging index and our working directory exactly match the repo.
	* Most destructive, lose your data
	
#### soft reset
```
$ git reset --soft 9cbe0c7
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	modified:   resources.html
	
$ git diff --staged
diff --git a/resources.html b/resources.html
index 497c9e2..e609ff5 100755
--- a/resources.html
+++ b/resources.html
@@ -96,14 +96,14 @@
               <ul>
                 <li>Comfortable hiking shoes</li>
                 <li>Hat</li>
-                <li>Sunglasses</li>
-                <li>Sunscreen</li>
-                               <li>Insect repellent</li>
                 <li>Wet/dry bag to protect valuables</li>
                 <li>Comfortable backpack</li>
                 <li>Stainless steel water bottle</li>
                 <li>Multi-purpose tool</li>
                 <li>Pack no more than one additional day of clothing</li>
+                <li>Insect repellent</li>
+                <li>Sunglasses</li>
+                <li>Sunscreen</li>
               </ul>
             </li>
             <li>Bring comfortable shoes. (I know, we shouldn’t have to say that, but you’d be amazed)</li>
$ git reset --soft d3af33eb
$ git status
On branch master
nothing to commit, working tree clean
``` 
#### mixed reset
``` 
$ git log
commit d3af33ebc62f0a7a2d91832fd5382f0e79808e72 (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 12:40:48 2018 +0200

    Revert "Rearrange items to bring on an outdoor trip"

    This reverts commit 9cbe0c7fb83892b712020506dd246a429d0b3632.

commit 9cbe0c7fb83892b712020506dd246a429d0b3632
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 11:35:05 2018 +0200

    Rearrange items to bring on an outdoor trip
$ git reset --mixed 9cbe0c7
Unstaged changes after reset:
M	resources.html

$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   resources.html
	
$ git log
commit 9cbe0c7fb83892b712020506dd246a429d0b3632 (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 11:35:05 2018 +0200

    Rearrange items to bring on an outdoor trip

commit 4d1fcbe61d8943152b8c2a64ce1fa1267581fc12
Author: Eduardo <eduardos@spotify.com>
Date:   Sat Jul 28 21:13:59 2018 +0200

    Remove some contractions
    
$ git reset --mixed d3af33ebc
```

#### hard reset
```
$ git reset --hard 9cbe0c7f
HEAD is now at 9cbe0c7 Rearrange items to bring on an outdoor trip

$ git status
On branch master
nothing to commit, working tree clean

$ git log
commit 9cbe0c7fb83892b712020506dd246a429d0b3632 (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 11:35:05 2018 +0200

    Rearrange items to bring on an outdoor trip
    
$ git reset --hard d3af33e
HEAD is now at d3af33e Revert "Rearrange items to bring on an outdoor trip"


$ git log
commit d3af33ebc62f0a7a2d91832fd5382f0e79808e72 (HEAD -> master)
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 12:40:48 2018 +0200

    Revert "Rearrange items to bring on an outdoor trip"

    This reverts commit 9cbe0c7fb83892b712020506dd246a429d0b3632.

commit 9cbe0c7fb83892b712020506dd246a429d0b3632
Author: Eduardo <eduardos@spotify.com>
Date:   Sun Jul 29 11:35:05 2018 +0200

    Rearrange items to bring on an outdoor trip
    
```

### Removing untracked files

`git clean -n` is a test run

``` 
 git status
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	junk1
	junk2
	junk3

$ git clean -n
Would remove junk1
Would remove junk2
Would remove junk3
```

`git clean -f` forces to run it

``` 
$ git add junk1
$ git clean -f
Removing junk2
Removing junk3
$ git status
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	new file:   junk1
```
 
## Ignoring files
### Using .gitignore files

`project/.gitignore`

Provide Git with a set of rules that it can use to know which files to use for commits and which ones should be ignored. Those rules can be very simple, just a list of files one for each line or we can get little fancier, and you some very basic regular expressions. We can use the Asterisk, the Question Mark, a bracket of characters, a character set, or a range like 0-9.
* very basic regular expressions
	* * ? [aeiou] [0-9]
* negate expressions with !
	* *.php
	* !index.php
* ignore all files in a directory with trailing slash
	* assets/videos/
* comment lines begin with #, blank lines are skipped

```
$ cat .gitignore
.DS_store
*.zip
*.gz
log/*.log
log/*.log.[0-9]
assets/phothoshop/
assets/videos/
!assets/videos/tour*.mp4
```

### Ideas on what to ignore

* compiled source code
* pacakges and compressed files
* logs and databases
* operating system files generated
* user-uploaded files

Articles
* https://help.github.com/articles/ignoring-files/
* https://github.com/github/gitignore

### Ignoring files globally
* ignore files in all repositories
* settings not tracked in a repository
* user-specific instead of repository-specific

```
# Create global git ignore files
/Users/eduardos/.gitignore_global

git config --global core.excludesfile ~/.gitignore_global 

$ cat ~/.gitconfig
[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true
[user]
	name = Eduardo
	email = eduardos@spotify.com
[core]
	excludesfile = /Users/eduardos/.gitignore_global
[difftool "sourcetree"]
	cmd = opendiff \"$LOCAL\" \"$REMOTE\"
	path =
[mergetool "sourcetree"]
	cmd = /Applications/Sourcetree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"
	trustExitCode = true
	
``` 

### Ignorig tracked files
In case a file(s) has been comitted before, git will keep track of it. Git can ignore tracking files
`git rm --cached <file>`
* Remove this file from the staging index, not from the repository, just from the staging index.
* That will cause the file to stop being tracked. It will still leave the copy in the repo, it will still leave the copy in my working directory. It's just going to take it out of the index.
* Commit change of deleting.

### Tracking empty directories
Git is designed to be a file-tracking system
* track files
* ignore directories with no files

`add .gitkeep to your empty folder`

## Navigating the commit tree
### Referencing commits
*tree-ish*
* full SHA-1 hash
* short SHA-1 hash
	* at least 4 characters
	* unambiguos (8-10 characters)
* HEAD pointer
* branch reference
* tag reference
* ancestry <reference><^/~>
	* (^) caret - pointing up to the parent tree, moving up
	* (~) tilde - number of generatios
	* parent commit 
		* HEAD^, acf87504^, master^
		* HEAD~1, HEAD~
	* grandparent commit
		* HEAD^^, acf87504^^, master^^
		* HEAD~2
	* great-grandparent commit
		* HEAD^^^, acf87504^^^, master^^^
		* HEAD~3

### Exploring tree listing



